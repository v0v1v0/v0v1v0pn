<div class="container">

<table style="width: 100%;"><tr>
<td>DPMGibbsN</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Slice Sampling of the Dirichlet Process Mixture Model with a prior on alpha</h2>

<h3>Description</h3>

<p>Slice Sampling of the Dirichlet Process Mixture Model with a prior on alpha
</p>


<h3>Usage</h3>

<pre><code class="language-R">DPMGibbsN(
  z,
  hyperG0,
  a = 1e-04,
  b = 1e-04,
  N,
  doPlot = TRUE,
  nbclust_init = 30,
  plotevery = N/10,
  diagVar = TRUE,
  use_variance_hyperprior = TRUE,
  verbose = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>z</code></td>
<td>
<p>data matrix <code>d x n</code> with <code>d</code> dimensions in rows and <code>n</code> observations in
columns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hyperG0</code></td>
<td>
<p>prior mixing distribution.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a</code></td>
<td>
<p>shape hyperparameter of the Gamma prior on the concentration parameter of the Dirichlet
Process. Default is <code>0.0001</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b</code></td>
<td>
<p>scale hyperparameter of the Gamma prior on the concentration parameter of the Dirichlet
Process. Default is <code>0.0001</code>. If <code>0</code>, then the concentration is fixed set to <code>a</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>number of MCMC iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>doPlot</code></td>
<td>
<p>logical flag indicating whether to plot MCMC iteration or not. Default to
<code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbclust_init</code></td>
<td>
<p>number of clusters at initialization. Default to 30 (or less if there are less
than 30 observations).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plotevery</code></td>
<td>
<p>an integer indicating the interval between plotted iterations when <code>doPlot</code>
is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>diagVar</code></td>
<td>
<p>logical flag indicating whether the variance of each cluster is estimated as a
diagonal matrix, or as a full matrix. Default is <code>TRUE</code> (diagonal variance).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_variance_hyperprior</code></td>
<td>
<p>logical flag indicating whether a hyperprior is added 
for the variance parameter. Default is <code>TRUE</code> which decrease the impact of the variance prior
on the posterior. <code>FALSE</code> is useful for using an informative prior.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical flag indicating whether partition info is written in the console at each
MCMC iteration.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments to be passed to <code>plot_DPM</code>. Only used if <code>doPlot</code>
is <code>TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a object of class <code>DPMclust</code> with the following attributes:
</p>
<table>
<tr style="vertical-align: top;">
<td>
<code>mcmc_partitions</code>:</td>
<td>
<p> a list of length <code>N</code>. Each
element <code>mcmc_partitions[n]</code> is a vector of length
<code>n</code> giving the partition of the <code>n</code> observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>alpha</code>:</td>
<td>
<p> a vector of length <code>N</code>. <code>cost[j]</code> is the cost
associated to partition <code>c[[j]]</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>listU_mu</code>:</td>
<td>
<p>a list of length <code>N</code> containing the matrices of
mean vectors for all the mixture components at each MCMC iteration</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>listU_Sigma</code>:</td>
<td>
<p>a list of length <code>N</code> containing the arrays of
covariances matrices for all the mixture components at each MCMC iteration</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>U_SS_list</code>:</td>
<td>
<p>a list of length <code>N</code> containing the lists of
sufficient statistics for all the mixture components at each MCMC iteration</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>weights_list</code>:</td>
<td>
<p>a list of length <code>N</code> containing the logposterior values
at each MCMC iterations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>logposterior_list</code>:</td>
<td>
<p>a list of length <code>N</code> containing the logposterior values
at each MCMC iterations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>data</code>:</td>
<td>
<p> the data matrix <code>d x n</code> with <code>d</code> dimensions in rows
and <code>n</code> observations in columns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>nb_mcmcit</code>:</td>
<td>
<p> the number of MCMC iterations</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>clust_distrib</code>:</td>
<td>
<p>the parametric distribution of the mixture component - <code>"gaussian"</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td>
<code>hyperG0</code>:</td>
<td>
<p>the prior on the cluster location</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Boris Hejblum
</p>


<h3>Examples</h3>

<pre><code class="language-R">rm(list=ls())
#Number of data
n &lt;- 500
d &lt;- 4
#n &lt;- 2000
set.seed(1234)
#set.seed(123)
#set.seed(4321)

# Sample data
m &lt;- matrix(nrow=d, ncol=4, c(-1, 1, 1.5, 2, 2, -2, -1.5, -2))
p &lt;- c(0.2, 0.1, 0.4, 0.3) # frequence des clusters

sdev &lt;- array(dim=c(d,d,4))
sdev[, ,1] &lt;- 0.3*diag(d)
sdev[, ,2] &lt;- c(0.1, 0.3)*diag(d)
sdev[, ,3] &lt;- matrix(nrow=d, ncol=d, 0.15)
diag(sdev[, ,3]) &lt;- 0.3
sdev[, ,4] &lt;- 0.3*diag(d)
c &lt;- rep(0,n)
z &lt;- matrix(0, nrow=d, ncol=n)
for(k in 1:n){
 c[k] = which(rmultinom(n=1, size=1, prob=p)!=0)
 z[,k] &lt;- m[, c[k]] + sdev[, , c[k]]%*%matrix(rnorm(d, mean = 0, sd = 1), nrow=d, ncol=1)
 #cat(k, "/", n, " observations simulated\n", sep="")
}

 # Set parameters of G0
 hyperG0 &lt;- list()
 hyperG0[["mu"]] &lt;- rep(0,d)
 hyperG0[["kappa"]] &lt;- 0.001
 hyperG0[["nu"]] &lt;- d+2
 hyperG0[["lambda"]] &lt;- diag(d)/10

 # hyperprior on the Scale parameter of DPM
 a &lt;- 0.0001
 b &lt;- 0.0001

 # Number of iterations
 N &lt;- 30

 # do some plots
 doPlot &lt;- TRUE
 nbclust_init &lt;- 30



 ## Data
 ########
 library(ggplot2)
 p &lt;- (ggplot(data.frame("X"=z[1,], "Y"=z[2,]), aes(x=X, y=Y))
       + geom_point()
       + ggtitle("Toy example Data"))
 p


 ## alpha priors plots
 #####################
 prioralpha &lt;- data.frame("alpha"=rgamma(n=5000, shape=a, scale=1/b),
                         "distribution" =factor(rep("prior",5000),
                         levels=c("prior", "posterior")))
 p &lt;- (ggplot(prioralpha, aes(x=alpha))
       + geom_histogram(aes(y=..density..),
                        colour="black", fill="white", bins=30)
       + geom_density(alpha=.6, fill="red", color=NA)
       + ggtitle(paste("Prior distribution on alpha: Gamma(", a,
                 ",", b, ")\n", sep=""))
       + theme_bw()
      )
 p


if(interactive()){
 # Gibbs sampler for Dirichlet Process Mixtures
 ##############################################

 MCMCsample &lt;- DPMGibbsN(z, hyperG0, a, b, N=500, doPlot, nbclust_init, plotevery=100,
                         gg.add=list(theme_bw(),
                                 guides(shape=guide_legend(override.aes = list(fill="grey45")))),
                         diagVar=FALSE)

 plot_ConvDPM(MCMCsample, from=2)

 s &lt;- summary(MCMCsample, burnin = 200, thin=2, posterior_approx=FALSE,
 lossFn = "MBinderN")

 F &lt;- FmeasureC(pred=s$point_estim$c_est, ref=c)

 postalpha &lt;- data.frame("alpha"=MCMCsample$alpha[50:500],
                         "distribution" = factor(rep("posterior",500-49),
                         levels=c("prior", "posterior")))
 p &lt;- (ggplot(postalpha, aes(x=alpha))
       + geom_histogram(aes(y=..density..), binwidth=.1,
                        colour="black", fill="white")
       + geom_density(alpha=.2, fill="blue")
       + ggtitle("Posterior distribution of alpha\n")
       # Ignore NA values for mean
       # Overlay with transparent density plot
       + geom_vline(aes(xintercept=mean(alpha, na.rm=TRUE)),
                    color="red", linetype="dashed", size=1)
     )
 p

 p &lt;- (ggplot(drop=FALSE, alpha=.6)
       + geom_density(aes(x=alpha, fill=distribution),
                      color=NA, alpha=.6,
                      data=prioralpha)
       #+ geom_density(aes(x=alpha, fill=distribution),
       #               color=NA, alpha=.6,
       #               data=postalpha)
       + ggtitle("Prior and posterior distributions of alpha\n")
       + scale_fill_discrete(drop=FALSE)
       + theme_bw()
       +xlim(0,10)
       +ylim(0, 1.3)
     )
 p

}

# k-means comparison
####################

 plot(x=z[1,], y=z[2,], col=kmeans(t(z), centers=4)$cluster,
      xlab = "d = 1", ylab= "d = 2", main="k-means with K=4 clusters")

 KM &lt;- kmeans(t(z), centers=4)
 dataKM &lt;- data.frame("X"=z[1,], "Y"=z[2,],
                    "Cluster"=as.character(KM$cluster))
 dataCenters &lt;- data.frame("X"=KM$centers[,1],
                           "Y"=KM$centers[,2],
                           "Cluster"=rownames(KM$centers))

 p &lt;- (ggplot(dataKM)
       + geom_point(aes(x=X, y=Y, col=Cluster))
       + geom_point(aes(x=X, y=Y, fill=Cluster, order=Cluster),
                    data=dataCenters, shape=22, size=5)
       + scale_colour_discrete(name="Cluster")
       + ggtitle("K-means with K=4 clusters\n"))
 p




</code></pre>


</div>