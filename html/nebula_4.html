<div class="container">

<table style="width: 100%;"><tr>
<td>nebula</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Association analysis of a multi-subject single-cell data set using a fast negative binomial mixed model</h2>

<h3>Description</h3>

<p>Association analysis of a multi-subject single-cell data set using a fast negative binomial mixed model
</p>


<h3>Usage</h3>

<pre><code class="language-R">nebula(
  count,
  id,
  pred = NULL,
  offset = NULL,
  min = c(1e-04, 1e-04),
  max = c(10, 1000),
  model = "NBGMM",
  method = "LN",
  cutoff_cell = 20,
  kappa = 800,
  opt = "lbfgs",
  verbose = TRUE,
  cpc = 0.005,
  mincp = 5,
  covariance = FALSE,
  output_re = FALSE,
  reml = 0,
  ncore = 2,
  fmaxsize = Inf
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>count</code></td>
<td>
<p>A raw count matrix of the single-cell data. The rows are the genes, and the columns are the cells. The matrix can be a matrix object or a sparse dgCMatrix object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>A vector of subject IDs. The length should be the same as the number of columns of the count matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pred</code></td>
<td>
<p>A design matrix of the predictors. The rows are the cells and the columns are the predictors. If not specified, an intercept column will be generated by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>A vector of the scaling factor. The values must be strictly positive. If not specified, a vector of all ones will be generated by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min</code></td>
<td>
<p>Minimum values for the overdispersions parameters <code class="reqn">\sigma^2</code> and <code class="reqn">\phi</code>. Must be positive. The default is c(1e-4,1e-4).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max</code></td>
<td>
<p>Maximum values for the overdispersions parameters <code class="reqn">\sigma^2</code> and <code class="reqn">\phi</code>. Must be positive. The default is c(10,1000).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>'NBGMM', 'PMM' or 'NBLMM'. 'NBGMM' is for fitting a negative binomial gamma mixed model. 'PMM' is for fitting a Poisson gamma mixed model. 'NGLMM' is for fitting a negative binomial lognormal mixed model (the same model as that in the lme4 package). The default is 'NBGMM'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>'LN' or 'HL'. 'LN' is to use NEBULA-LN and 'HL' is to use NEBULA-HL. The default is 'LN'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cutoff_cell</code></td>
<td>
<p>The data will be refit using NEBULA-HL to estimate both overdispersions if the product of the cells per subject and the estimated cell-level overdispersion parameter <code class="reqn">\phi</code> is smaller than cutoff_cell. The default is 20.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kappa</code></td>
<td>
<p>Please see the vignettes for more details. The default is 800.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>opt</code></td>
<td>
<p>'lbfgs' or 'trust'. Specifying the optimization algorithm used in NEBULA-LN. The default is 'lbfgs'. If it is 'trust', a trust region algorithm based on the Hessian matrix will be used for optimization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>An optional logical scalar indicating whether to print additional messages. Default is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cpc</code></td>
<td>
<p>A non-negative threshold for filtering low-expression genes. Genes with counts per cell smaller than the specified value will not be analyzed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mincp</code></td>
<td>
<p>A positive integer threshold for filtering low-expression genes. A gene will not be analyzed if its number of cells that have a non-zero count is smaller than the specified value .</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariance</code></td>
<td>
<p>If TRUE, nebula will output the covariance matrix for the estimated log(FC), which can be used for testing contrasts.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_re</code></td>
<td>
<p>If TRUE, nebula will output the subject-level random effects. Only effective for model='NBGMM' or 'NBLMM'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reml</code></td>
<td>
<p>Either 0 (default) or 1. If it is one, REML will be used to estimate the overdispersions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncore</code></td>
<td>
<p>The number of cores used for parallel computing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fmaxsize</code></td>
<td>
<p>The maximum allowed total size (in bytes) of global variables (future.globals.maxSize) when using parallel computing.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>summary: The estimated coefficient, standard error and p-value for each predictor.
</p>
<p>overdispersion: The estimated cell-level and subject-level overdispersions <code class="reqn">\sigma^2</code> and <code class="reqn">\phi^{-1}</code>.
</p>
<p>convergence: More information about the convergence of the algorithm for each gene. A value of -20 or lower indicates a potential failure of the convergence. A value of one indicates that the convergence is reached due to a sufficiently small improvement of the function value. A value of -10 indicates that the convergence is reached because the gradients are close to zero (i.e., the critical point) and no improvement of the function value can be found.
</p>
<p>algorithm: The algorithm used for analyzing the gene. More information can be found in the vignettes.
</p>
<p>covariance: The covariance matrix for the estimated log(FC).
</p>
<p>random_effect: The subject-level random effects.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(nebula)
data(sample_data)
pred = model.matrix(~X1+X2+cc,data=sample_data$pred)
re = nebula(count=sample_data$count,id=sample_data$sid,pred=pred)

</code></pre>


</div>