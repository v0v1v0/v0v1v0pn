<div class="container">

<table style="width: 100%;"><tr>
<td>control_traj</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate the trajectory of a discrete linear time invariant system under a given control scheme</h2>

<h3>Description</h3>

<p>This function is designed to work with control_scheme objects generated by <code>control_scheme_DLI_freestate</code> 
In future versions of <code>netcontrol</code> this function will be used to simulate any control trajectory. 
For general details on control theory trajectories, see (Lewis et al. 2012).
</p>


<h3>Usage</h3>

<pre><code class="language-R">control_traj(t_max, x_0, A, B, theta = NA, gamma = NA, control_scheme,
  delta = NA, d_nosign = F, d_toggle = F, upper_bounds = NA,
  lower_bounds = NA, u_pos = F)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>t_max</code></td>
<td>
<p>Required. An integer total number of time points to determine the trajectory over</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_0</code></td>
<td>
<p>Required. A <code class="reqn">p</code> length numeric vector of starting values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>A</code></td>
<td>
<p>Required. A <code class="reqn">p x p</code> matrix of system coefficients</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>Required. A <code class="reqn">p x q</code> matrix of control weights</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>Optional. A <code class="reqn">p x p</code> covariance matrix for state errors. If <code>NA</code>, state mechanics will be deterministic</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>
<p>Optional. A <code class="reqn">p x p</code> covariance matrix for observation errors. If <code>NA</code>, no observation/measurement error will be modelled.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control_scheme</code></td>
<td>
<p>Required. A list containing an entry labeled <code>gain_seq</code> containing either 1 or <code>t_max - 1</code> Kalman gain matrices and an entry labeled <code>cost_func</code> which contains an appropriately constructed cost function</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta</code></td>
<td>
<p>Optional. A vector of length 2, where the first entry contains the point of saturation for control inputs, and the second entry contains the saturation value for control inputs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d_nosign</code></td>
<td>
<p>Optional. Boolean. If <code>TRUE</code> and <code>delta</code> is not <code>NA</code>, control inputs are forced to be positive.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d_toggle</code></td>
<td>
<p>Optional. Boolean. If <code>TRUE</code> and <code>delta</code> is not <code>NA</code>, control inputs are either 0 or the saturation value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upper_bounds</code></td>
<td>
<p>Optional. A <code class="reqn">p</code> length vector of upper bounds on state values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower_bounds</code></td>
<td>
<p>Optional. A <code class="reqn">p</code> length vector of lower bounds on state values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u_pos</code></td>
<td>
<p>Optional. Boolean. If <code>TRUE</code> restricts control inputs to be positive,</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>CAUTION: Use of saturation parameters and/or bound parameters <code>delta, d_nosign, d_toggle, upper.bound, lower.bound, u.pos</code> 
leads to estimates of the optimal trajectory to be sub-optimal, as the Kalman gain calculations do not take any of those restrictions into account.
This functionality will be added later, and this caution statement removed at that time.
</p>


<h3>Value</h3>

<p>A list containing 4 entries: a 't_max x p' state value matrix, a 't_max x p' observation matrix, a 't_max-1 x q' matrix of control inputs and a 't_max' length vector of cost function values.
</p>


<h3>References</h3>

<p>Lewis FL, Vrabie DL, Syrmos VL (2012).
<em>Optimal Control</em>, 3rd ed edition.
Wiley, Hoboken.
ISBN 978-0-470-63349-6..
</p>


<h3>Examples</h3>

<pre><code class="language-R">
A = matrix(c(0,-3,-2,2,-2,1,-1,2,-1), 3,3)

#Normalize rows to sum to 1
A = solve(diag(rowSums(A))) %*% A

B = S = Q_seq = R_seq = diag(3)

CS = control_scheme_DLI_freestate(100, A, B, S, Q_seq, R_seq)

traj = control_traj(100, rep(100,3), A, B, control_scheme = CS)

#First 5 control inputs
print(head(traj[[3]]))
</code></pre>


</div>