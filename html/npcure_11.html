<div class="container">

<table style="width: 100%;"><tr>
<td>probcurehboot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Compute the Bootstrap Bandwidth for the Nonparametric Estimator
of the Cure Probability
</h2>

<h3>Description</h3>

<p>This function computes the bootstrap bandwidth for the
nonparametric estimator of the conditional probability of cure.
</p>


<h3>Usage</h3>

<pre><code class="language-R">probcurehboot(x, t, d, dataset, x0, bootpars = controlpars())
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>If <code>dataset</code> is missing, a numeric object giving the
covariate values. If <code>dataset</code> is a data frame, it is
interpreted as the name of the variable corresponding to the
covariate in the data frame.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>
<p>If <code>dataset</code> is missing, a numeric object giving the
observed times. If <code>dataset</code> is a data frame, it is interpreted
as the name of the variable corresponding to the observed times in
the data frame.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d</code></td>
<td>
<p>If <code>dataset</code> is missing, an integer object giving the
values of the uncensoring indicator. Censored observations must be
coded as 0, uncensored ones as 1. If <code>dataset</code> is a data frame,
it is interpreted as the name of the variable corresponding to the
uncensoring indicator in the data frame.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dataset</code></td>
<td>
<p>An optional data frame in which the variables named in
<code>x</code>, <code>t</code> and <code>indicator</code> are interpreted. If it is
missing, <code>x</code>, <code>t</code> and <code>indicator</code> must be objects
of the workspace.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x0</code></td>
<td>
<p>A numeric vector of covariate values where the local
bootstrap bandwidth will be computed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bootpars</code></td>
<td>
<p>A list of parameters controlling the process of
bandwidth selection. The default is the value returned by the
<code>controlpars</code> function called without arguments.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function computes the bootstrap bandwidth selector for the
nonparametric estimator of the cure probability at the covariate
values given by <code>x0</code>. The bootstrap bandwidth is the minimizer of
a bootstrap version of the Mean Squared Error (MSE) of the cure rate
estimator, which is approximated by Monte Carlo by simulating a large
number, <code>B</code>, of bootstrap resamples. The bootstrap MSE is the
bootstrap expectation of the difference between the value of the cure
rate estimator computed with the bootstrap sample in a grid of
bandwidths and its value computed with the original sample and a pilot
bandwidth. The bootstrap resamples are generated by using the simple
weighted bootstrap resampling method, fixing the covariate. This
method is equivalent to the simple weighted bootstrap of Li and Datta
(2001). All the parameters involved in the bootstrap bandwidth
selection process (number of bootstrap resamples, grid of bandwidths,
and pilot bandwidth) are typically set through the <code>controlpars</code>
function, whose output is passed to the <code>bootpars</code>
argument. See the help of <code>controlpars</code> for details.
</p>
<p>Given the local nature of bootstrap bandwidth selection, estimates
obtained from sets of bootstrap bandwidths may sometimes look
wiggly. To counter this behavior, the selected vector of bootstrap
bandwidths can be smoothed by computing a moving average (its order
being set by <code>controlpars</code>). Then, the smoothed bandwidths are
contained in the <code>hsmooth</code> component of the returned value.
</p>


<h3>Value</h3>

<p>An object of S3 class 'npcure'. Formally, a list of components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>The constant character string c("Bootstrap bandwidth",
"cure").
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x0</code></td>
<td>
<p>Grid of covariate values.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>h</code></td>
<td>
<p>Selected local bootstrap bandwidths.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hsmooth</code></td>
<td>
<p>Smoothed selected local bootstrap bandwidths (optional)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hgrid</code></td>
<td>
<p>Grid of bandwidths used (optional).
</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Ignacio López-de-Ullibarri [aut, cre],
Ana López-Cheda [aut],
Maria Amalia Jácome [aut]
</p>


<h3>References</h3>

<p>Li, G., Datta, S. (2001). A bootstrap approach to
nonparametric regression for right censored data. Annals of the
Institute of Statistical Mathematics, 53:
708-729. <a href="https://doi.org/10.1023/A:1014644700806">https://doi.org/10.1023/A:1014644700806</a>.
</p>
<p>López-Cheda, A., Cao, R., Jácome, M. A., Van Keilegom,
I. (2017). Nonparametric incidence estimation and bootstrap bandwidth
selection in mixture cure models. Computational Statistics &amp; Data
Analysis, 105:
144–165. <a href="https://doi.org/10.1016/j.csda.2016.08.002">https://doi.org/10.1016/j.csda.2016.08.002</a>.
</p>


<h3>See Also</h3>

<p><code>controlpars</code>, <code>probcure</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Some artificial data
set.seed(123)
n &lt;- 50
x &lt;- runif(n, -2, 2) ## Covariate values
y &lt;- rweibull(n, shape = .5*(x + 4)) ## True lifetimes
c &lt;- rexp(n) ## Censoring values
p &lt;- exp(2*x)/(1 + exp(2*x)) ## Probability of being susceptible
u &lt;- runif(n)
t &lt;- ifelse(u &lt; p, pmin(y, c), c) ## Observed times
d &lt;- ifelse(u &lt; p, ifelse(y &lt; c, 1, 0), 0) ## Uncensoring indicator
data &lt;- data.frame(x = x, t = t, d = d)

## A vector of covariate values 
vecx0 &lt;- seq(-1.5, 1.5, by = .1)

## Computation of bootstrap local bandwidth at the values of 'vecx0'...
#### ... with the default control parameters
set.seed(1) ## Not needed, just for reproducibility.
hb1 &lt;- probcurehboot(x, t, d, data, x0 = vecx0)

#### ... changing the default 'bootpars' through 'controlpars()', with
#### arguments:
#### (a) 'B = 1999' (1999 bootstrap resamples are generated),
#### (b) 'hbound = c(.2, 4)' and 'hl = 50' (a grid of 50 bandwidths
#### between 0.2 and 4 times the standardized interquartilic range of
#### the covariate values is built),
#### (c) 'hsave = TRUE' (the grid bandwidths are saved), and
#### (d) 'hsmooth = 7' (the bootstrap bandwidths are smoothed by a
#### moving average of 7-th order)
set.seed(1) ## Not needed, just for reproducibility.
hb2 &lt;- probcurehboot(x, t, d, data, x0 = vecx0, bootpars =
controlpars(B = 1999, hbound = c(.2, 4), hl = 50, hsave = TRUE, hsmooth
= 7)) 

## Estimates of the conditional probability of cure at the covariate
## values of 'vecx0' with the selected bootstrap bandwidths
q1 &lt;- probcure(x, t, d, data, x0 = vecx0, h = hb1$h)
q2 &lt;- probcure(x, t, d, data, x0 = vecx0, h = hb2$h)
q2sm &lt;- probcure(x, t, d, data, x0 = vecx0, h = hb2$hsmooth)

## A plot comparing the estimates obtained with the bootstrap bandwidths
plot(q1$x0, q1$q, type = "l", xlab = "Covariate", ylab =
"Cure probability", ylim = c(0,1))
lines(q2$x0, q2$q, type = "l", lty = 2)
lines(q2sm$x0, q2sm$q, type = "l", lty = 3)
lines(q1$x0, 1 - exp(2*q1$x0)/(1 + exp(2*q1$x0)), col = 2)
legend("topright", c("Estimate with 'hb1'", "Estimate with 'hb2'",
"Estimate with 'hb2' smoothed", "True"), lty = c(1, 2, 3, 1), col = c(1,
1, 1, 2)) 


## Example with the dataset 'bmt' of the 'KMsurv' package
## to study the probability of cure as a function of the age (z1).
data("bmt", package = "KMsurv")
x0 &lt;- seq(quantile(bmt$z1, .05), quantile(bmt$z1, .95), length.out =
100)
## This might take a while
hb &lt;- probcurehboot(z1, t2, d3, bmt, x0 = x0, bootpars =
controlpars(B = 1999, hbound = c(.2, 2), hl = 50, hsave = TRUE, hsmooth
= 10))
q.age &lt;- probcure(z1, t2, d3, bmt, x0 = x0, h = hb$h)
q.age.smooth &lt;- probcure(z1, t2, d3, bmt, x0 = x0, h = hb$hsmooth)

## Plot of estimated cure probability
plot(q.age$x0, q.age$q, type = "l", ylim = c(0, 1), xlab =
"Patient age (years)", ylab = "Cure probability")
lines(q.age.smooth$x0, q.age.smooth$q, col = 2)
legend("topright", c("Estimate with h bootstrap",
"Estimate with smoothed h bootstrap"), lty = 1, col = 1:2)

</code></pre>


</div>